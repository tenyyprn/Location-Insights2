import React, { useState } from 'react';
import { useAddress } from '../context/AddressContext';

import { aiAnalysisService, AIAnalysisResult, LifestyleAnalysisData } from '../services/AIAnalysisService';
import { IntegratedDataService, IntegratedAreaData } from '../services/IntegratedDataService';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line } from 'recharts';

interface EnhancedLifestyleAnalysisProps {
  currentAddress?: string;
  coordinates?: { lat: number; lng: number };
}

interface EnhancedAnalysisResult {
  basicScores: {
    safety: number;
    transport: number;
    shopping: number;
    medical: number;
    education: number;
    environment: number;
    total: number;
  };
  integratedData: IntegratedAreaData | null;
  aiAnalysis: AIAnalysisResult | null;
  marketAnalysis: {
    averagePrice: number;
    pricePerSqm: number;
    marketTrend: 'rising' | 'stable' | 'declining';
    investmentRating: string;
    priceHistory: Array<{ year: string; price: number }>;
    competitiveAnalysis: {
      rank: number;
      totalAreas: number;
      comparison: string;
    };
  };
  riskAssessment: {
    overallRisk: number;
    riskFactors: string[];
    recommendations: string[];
    riskBreakdown: {
      earthquake: number;
      flood: number;
      landslide: number;
      fire: number;
    };
  };
  urbanPlanning: {
    zoning: string;
    buildingRestrictions: string[];
    futureProjects: string[];
    developmentPotential: string;
    regulations: {
      buildingCoverage: number;
      floorAreaRatio: number;
      heightLimit: number;
    };
  };
  facilities: {
    education: Array<{ name: string; type: string; distance: number; rating?: number }>;
    medical: Array<{ name: string; type: string; distance: number; specialties?: string[] }>;
    transport: Array<{ name: string; line: string; distance: number; accessibility: string }>;
    commercial: Array<{ name: string; type: string; distance: number }>;
    recreation: Array<{ name: string; type: string; distance: number }>;
  };
}

const EnhancedLifestyleAnalysis: React.FC<EnhancedLifestyleAnalysisProps> = ({ 
  currentAddress: propAddress, 
  coordinates: propCoordinates 
}) => {
  const { currentAddress: contextAddress, coordinates: contextCoordinates } = useAddress();
  
  const currentAddress = propAddress || contextAddress;
  const coordinates = propCoordinates || contextCoordinates || undefined;
  const [analysisResult, setAnalysisResult] = useState<EnhancedAnalysisResult | null>(null);
  const [loading, setLoading] = useState(false);
  const [activeTab, setActiveTab] = useState<'overview' | 'ai' | 'market' | 'facilities' | 'risks' | 'planning'>('overview');

  const analyzeArea = async () => {
    if (!currentAddress || !coordinates) {
      alert('‰ΩèÊâÄ„Å®Â∫ßÊ®ôÊÉÖÂ†±„ÅåÂøÖË¶Å„Åß„Åô');
      return;
    }

    console.log('üîç Áí∞Â¢ÉÂ§âÊï∞„ÉÅ„Çß„ÉÉ„ÇØ:', {
      REACT_APP_OPENAI_API_KEY: process.env.REACT_APP_OPENAI_API_KEY ? 'Ë®≠ÂÆöÊ∏à„Åø' : 'Êú™Ë®≠ÂÆö',
      keyLength: process.env.REACT_APP_OPENAI_API_KEY?.length || 0
    });

    setLoading(true);
    try {
      console.log(`üîç Áµ±ÂêàAPIÂàÜÊûêÈñãÂßã: ${currentAddress}`);
      
      // Áµ±Âêà„Éá„Éº„ÇøÂèñÂæó„ÇíË©¶Ë°å
      let integratedData: IntegratedAreaData | null = null;
      let aiAnalysis: AIAnalysisResult | null = null;
      
      try {
        // Google Maps + ÂõΩÂúü‰∫§ÈÄöÁúÅAPI„Åã„ÇâÂÆü„Éá„Éº„ÇøÂèñÂæó
        console.log('üåç Google Maps & ÂõΩÂúü‰∫§ÈÄöÁúÅAPIÁµ±ÂêàÂèñÂæó‰∏≠...');
        
        integratedData = await IntegratedDataService.fetchComprehensiveAreaData(
          coordinates, 
          currentAddress
        );
        
        console.log('‚úÖ Áµ±Âêà„Éá„Éº„ÇøÂèñÂæóÊàêÂäü:', integratedData);
        
        // AIÂàÜÊûê„ÇíÂÆüË°å
        console.log('ü§ñ AI‰ΩèÁí∞Â¢ÉÂàÜÊûêÈñãÂßã...');
        
        try {
          console.log('ü§ñ AIÂàÜÊûêÈñãÂßã‰∏≠...');
          
          // AIÂàÜÊûêÁî®„Éá„Éº„Çø„ÇíÊ∫ñÂÇô
          const analysisData: LifestyleAnalysisData = {
            address: currentAddress,
            coordinates: integratedData?.coordinates || { lat: 0, lng: 0 },
            educationCount: integratedData?.education?.total || 0,
            medicalCount: integratedData?.medical?.total || 0,
            commercialCount: integratedData?.commercial?.length || 0,
            transportCount: integratedData?.transport?.length || 0,
            environmentCount: integratedData?.recreation?.length || 0,
            safetyCount: 0,
            totalScore: 75, // ‰ªÆ„ÅÆ„Çπ„Ç≥„Ç¢
            scores: {
              education: 80,
              medical: 70,
              transport: 85,
              shopping: 75,
              dining: 80,
              safety: 65,
              environment: 70,
              cultural: 75
            },
            educationDetails: [...(integratedData?.education?.elementary || []), ...(integratedData?.education?.juniorHigh || [])],
            medicalDetails: [...(integratedData?.medical?.hospitals || []), ...(integratedData?.medical?.clinics || [])],
            commercialDetails: integratedData?.commercial || [],
            diningDetails: integratedData?.commercial || [], // È£≤È£üÂ∫ó„Éá„Éº„Çø„ÇíËøΩÂä†
            transportDetails: integratedData?.transport || []
          };
          
          aiAnalysis = await aiAnalysisService.generateLifestyleAnalysis(analysisData);
          console.log('‚úÖ AIÂàÜÊûêÂÆå‰∫Ü:', aiAnalysis);
        } catch (aiError) {
          console.warn('‚ö†Ô∏è AIÂàÜÊûê„Ç®„É©„Éº:', aiError);
        }
        
      } catch (apiError) {
        console.error('‚ùå Áµ±ÂêàAPIÂèñÂæó„Ç®„É©„Éº:', apiError);
        alert('API„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„ÅåËµ∑Âãï„Åó„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        // „Ç®„É©„ÉºÊôÇ„ÅØÂá¶ÁêÜ„ÇíÁµÇ‰∫Ü„Åó„ÄÅÁµêÊûú„ÇíË®≠ÂÆö„Åó„Å™„ÅÑ
        return;
      }

      const result: EnhancedAnalysisResult = {
        basicScores: calculateBasicScores(integratedData),
        integratedData,
        aiAnalysis,
        marketAnalysis: calculateMarketAnalysis(integratedData, currentAddress),
        riskAssessment: calculateRiskAssessment(integratedData, currentAddress),
        urbanPlanning: analyzeUrbanPlanning(integratedData, currentAddress),
        facilities: analyzeFacilities(integratedData, currentAddress)
      };

      setAnalysisResult(result);
      console.log('‚úÖ Áµ±ÂêàÂàÜÊûêÂÆå‰∫Ü:', result);

    } catch (error) {
      console.error('‚ùå Áµ±ÂêàÂàÜÊûê„Ç®„É©„Éº:', error);
      alert('ÂàÜÊûê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„ÅèÂæå„Å´ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
    } finally {
      setLoading(false);
    }
  };

  // Âü∫Êú¨„Çπ„Ç≥„Ç¢Ë®àÁÆóÔºàÁµ±Âêà„Éá„Éº„ÇøÁâàÔºâ
  const calculateBasicScores = (data: IntegratedAreaData | null) => {
    const education = calculateEducationScore(data?.education);
    const medical = calculateMedicalScore(data?.medical);
    const transport = calculateTransportScore(data?.transport);
    const safety = calculateSafetyScore(data?.disaster);
    const shopping = calculateShoppingScore(data);
    const environment = calculateEnvironmentScore(data);
    const total = (education + medical + transport + safety + shopping + environment) / 6;
    return { education, medical, transport, safety, shopping, environment, total };
  };

  const calculateEducationScore = (education: any) => {
    if (!education) return 50;
    const total = education.total || 0;
    const hasUniversity = education.university?.length > 0;
    
    let score = Math.min(50 + total * 5, 95);
    if (hasUniversity) score += 10;
    return Math.min(score, 100);
  };

  const calculateMedicalScore = (medical: any) => {
    if (!medical) return 40;
    const total = medical.total || 0;
    const hasHospital = medical.hospitals?.length > 0;
    
    let score = 40 + total * 8;
    if (hasHospital) score += 15;
    return Math.min(score, 100);
  };

  const calculateTransportScore = (transport: any[] | undefined) => {
    if (!transport || transport.length === 0) return 50;
    const stationCount = transport.length;
    const avgDistance = transport.reduce((acc, s) => acc + (s.distance || 500), 0) / transport.length;
    
    let score = 50 + stationCount * 15;
    if (avgDistance < 300) score += 10;
    if (avgDistance < 200) score += 10;
    return Math.min(score, 100);
  };

  const calculateSafetyScore = (disaster: any) => {
    if (!disaster) return 95;
    const riskCount = (disaster.flood?.length || 0) + (disaster.landslide?.length || 0) + (disaster.earthquake?.length || 0);
    return Math.max(95 - riskCount * 10, 30);
  };

  const calculateShoppingScore = (data: IntegratedAreaData | null) => {
    if (!data || !data.commercial) {
      console.warn('ÂïÜÊ•≠ÊñΩË®≠„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
      return 0;
    }
    
    const commercialCount = data.commercial.length;
    let score = Math.min(50 + commercialCount * 5, 100);
    
    // Ë∑ùÈõ¢„Å´Âü∫„Å•„ÅèË™øÊï¥
    const closeShops = data.commercial.filter(shop => shop.distance < 300).length;
    if (closeShops > 0) {
      score += Math.min(closeShops * 5, 20);
    }
    
    return Math.min(score, 100);
  };

  const calculateEnvironmentScore = (data: IntegratedAreaData | null) => {
    if (!data || !data.recreation) {
      console.warn('Áí∞Â¢É„Éª„É¨„ÇØ„É™„Ç®„Éº„Ç∑„Éß„É≥„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
      return 50; // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éô„Éº„Çπ„Çπ„Ç≥„Ç¢
    }
    
    const recreationCount = data.recreation.length;
    let score = 50; // „Éô„Éº„Çπ„Çπ„Ç≥„Ç¢
    
    // ÂÖ¨Âúí„ÇÑ„É¨„ÇØ„É™„Ç®„Éº„Ç∑„Éß„É≥ÊñΩË®≠„ÅÆÊï∞„Å´Âü∫„Å•„ÅÑ„Å¶Âä†ÁÇπ
    score += Math.min(recreationCount * 8, 30);
    
    // Ëøë„Åè„Å´„ÅÇ„ÇãÊñΩË®≠„ÅÆ„Éú„Éº„Éä„Çπ
    const nearbyParks = data.recreation.filter(rec => rec.distance < 500).length;
    if (nearbyParks > 0) {
      score += Math.min(nearbyParks * 10, 20);
    }
    
    return Math.min(score, 100);
  };

  // Â∏ÇÂ†¥ÂàÜÊûêË®àÁÆóÔºàÁµ±Âêà„Éá„Éº„ÇøÁâàÔºâ
  const calculateMarketAnalysis = (data: IntegratedAreaData | null, address?: string) => {
    const marketData = data?.marketAnalysis;
    // Âú∞‰æ°„Éá„Éº„Çø„ÅØ priceHistory „Åß‰ΩøÁî®„Åï„Çå„Çã„Åü„ÇÅ„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà
    // const landPriceData = data?.landPrice || [];
    
    // Áµ±Âêà„Éá„Éº„Çø„Åã„ÇâÂπ≥Âùá‰æ°Ê†º„ÇíÁÆóÂá∫
    const averageLandPrice = marketData?.averageLandPrice || 2000000;
    const averagePrice = averageLandPrice * 50; // Ê¶ÇÁÆóÔºöÂú∞‰æ° √ó 50 = Áâ©‰ª∂‰æ°Ê†º
    const pricePerSqm = averageLandPrice;
    
    const investmentRating = marketData?.investmentGrade || 'C';
    const marketTrend = marketData?.trend === '‰∏äÊòáÂÇæÂêë' ? 'rising' : 'stable';
    
    // ÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Åã„Çâ‰æ°Ê†ºÊé®Áßª„Çí‰ΩúÊàê
    let priceHistory: Array<{ year: string; price: number }> = [];
    if (data && data.landPrice && data.landPrice.length > 0) {
      // ÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶‰æ°Ê†ºÊé®Áßª„ÇíË®àÁÆó
      priceHistory = data.landPrice.map(price => ({
        year: price.year || String(new Date(price.date).getFullYear()),
        price: price.value || 0
      }));
      console.log('Âú∞‰æ°„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü:', priceHistory);
    } else {
      priceHistory = [];
      console.warn('‰æ°Ê†ºÊé®Áßª„Éá„Éº„Çø„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
    }

    // „Ç®„É™„Ç¢Âà•„É©„É≥„Ç≠„É≥„Ç∞Ôºà„Éá„Éº„ÇøÂìÅË≥™„Å´Âü∫„Å•„ÅèÔºâ
    const dataQuality = data?.statistics?.dataQuality || 0;
    let rank, comparison;
    if (dataQuality > 80) {
      rank = 3;
      comparison = 'È´òÂìÅË≥™„Éá„Éº„Çø„Å´„Çà„Çã‰∏ä‰Ωç„É©„É≥„ÇØÂú∞Âüü';
    } else if (dataQuality > 50) {
      rank = 15;
      comparison = '‰∏≠ÂìÅË≥™„Éá„Éº„Çø„Å´„Çà„Çã‰∏≠‰Ωç„É©„É≥„ÇØÂú∞Âüü';
    } else {
      rank = 45;
      comparison = 'Âü∫Êú¨„Éá„Éº„Çø„Å´„Çà„ÇãÊ®ôÊ∫ñÂú∞Âüü';
    }

    return {
      averagePrice,
      pricePerSqm,
      marketTrend: marketTrend as 'rising' | 'stable' | 'declining',
      investmentRating,
      priceHistory,
      competitiveAnalysis: {
        rank,
        totalAreas: 50,
        comparison
      }
    };
  };

  // „É™„Çπ„ÇØË©ï‰æ°Ë®àÁÆóÔºàÁµ±Âêà„Éá„Éº„ÇøÁâàÔºâ
  const calculateRiskAssessment = (data: IntegratedAreaData | null, address?: string) => {
    const disaster = data?.disaster;
    const riskLevel = disaster?.riskLevel || 'ÊÉÖÂ†±„Å™„Åó';
    
    const riskFactors = [];
    const recommendations = [];
    
    // ÁÅΩÂÆ≥„É™„Çπ„ÇØÂàÜÊûê
    if (disaster?.flood && disaster.flood.length > 0) {
      riskFactors.push('Ê¥™Ê∞¥„É™„Çπ„ÇØ');
      recommendations.push('Ê¥™Ê∞¥„Éè„Ç∂„Éº„Éâ„Éû„ÉÉ„Éó„ÅÆÁ¢∫Ë™ç„Å®ÈÅøÈõ£ÁµåË∑Ø„ÅÆÊääÊè°');
    }
    
    if (disaster?.landslide && disaster.landslide.length > 0) {
      riskFactors.push('ÂúüÁ†ÇÁÅΩÂÆ≥„É™„Çπ„ÇØ');
      recommendations.push('ÂúüÁ†ÇÁÅΩÂÆ≥Ë≠¶ÊàíÂå∫Âüü„ÅÆÁä∂Ê≥ÅÁ¢∫Ë™ç');
    }
    
    if (disaster?.earthquake && disaster.earthquake.length > 0) {
      riskFactors.push('Âú∞Èúá„É™„Çπ„ÇØ');
      recommendations.push('ËÄêÈúáÊÄß„ÅÆÈ´ò„ÅÑÂª∫Áâ©„ÅÆÈÅ∏Êäû');
    }
    
    // Âü∫Êú¨ÁöÑ„Å™Êé®Â•®‰∫ãÈ†Ö
    if (riskFactors.length === 0) {
      recommendations.push('ÂÆöÊúüÁöÑ„Å™Èò≤ÁÅΩÁî®ÂìÅ„ÅÆÁÇπÊ§ú');
      recommendations.push('Âú∞Âüü„ÅÆÈò≤ÁÅΩË®ìÁ∑¥„Å∏„ÅÆÂèÇÂä†');
    }
    
    // „É™„Çπ„ÇØ„É¨„Éô„É´„ÅÆÊï∞ÂÄ§Âåñ
    let overallRisk = 20; // „Éô„Éº„Çπ„É™„Çπ„ÇØ
    if (riskLevel === 'È´ò„É™„Çπ„ÇØ') overallRisk = 80;
    else if (riskLevel === '‰∏≠„É™„Çπ„ÇØ') overallRisk = 50;
    else if (riskLevel === '‰Ωé„É™„Çπ„ÇØ') overallRisk = 20;
    
    return {
      overallRisk,
      riskFactors,
      recommendations,
      riskBreakdown: {
        earthquake: disaster?.earthquake?.length ? 70 : 20,
        flood: disaster?.flood?.length ? 60 : 15,
        landslide: disaster?.landslide?.length ? 55 : 10,
        fire: 25 // Âü∫Êú¨ÁöÑ„Å™ÁÅ´ÁÅΩ„É™„Çπ„ÇØ
      }
    };
  };

  // ÈÉΩÂ∏ÇË®àÁîªÂàÜÊûê
  const analyzeUrbanPlanning = (data: IntegratedAreaData | null, address?: string) => {
    if (!data) {
      console.warn('ÈÉΩÂ∏ÇË®àÁîªÂàÜÊûê„Å´ÂøÖË¶Å„Å™„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
      return {
        zoning: '„Éá„Éº„Çø„Å™„Åó',
        buildingRestrictions: ['„Éá„Éº„Çø„Å™„Åó'],
        futureProjects: ['„Éá„Éº„Çø„Å™„Åó'],
        developmentPotential: '„Éá„Éº„Çø„Å™„Åó',
        regulations: {
          buildingCoverage: 0,
          floorAreaRatio: 0,
          heightLimit: 0
        }
      };
    }
    
    // ÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çå„Å∞„Åù„Çå„Çí‰ΩøÁî®„ÄÅ„Å™„Åë„Çå„Å∞Âü∫Êú¨ÊÉÖÂ†±„ÇíË°®Á§∫
    return {
      zoning: data.address ? `${data.address}„Ç®„É™„Ç¢„ÅÆÁî®ÈÄîÂú∞Âüü` : 'Áî®ÈÄîÂú∞ÂüüÊÉÖÂ†±„Å™„Åó',
      buildingRestrictions: [
        'APIÂÆüË£ÖÂæÖ„Å° - Âª∫ÁØâÂü∫Ê∫ñÊ≥ï„Å´Âü∫„Å•„ÅèÂà∂Èôê„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô'
      ],
      futureProjects: [
        'APIÂÆüË£ÖÂæÖ„Å° - Â∞ÜÊù•„ÅÆÈñãÁô∫Ë®àÁîªÊÉÖÂ†±„ÅØÂêÑËá™Ê≤ª‰Ωì„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ'
      ],
      developmentPotential: 'APIÂÆüË£ÖÂæÖ„Å° - ÈñãÁô∫„Éù„ÉÜ„É≥„Ç∑„É£„É´„ÅÆË©ï‰æ°',
      regulations: {
        buildingCoverage: 0,
        floorAreaRatio: 0,
        heightLimit: 0
      }
    };
  };

  // ÊñΩË®≠ÂàÜÊûêÔºàÁµ±Âêà„Éá„Éº„ÇøÁâàÔºâ
  const analyzeFacilities = (data: IntegratedAreaData | null, address?: string) => {
    const facilities = {
      education: [] as Array<{ name: string; type: string; distance: number; rating?: number }>,
      medical: [] as Array<{ name: string; type: string; distance: number; specialties?: string[] }>,
      transport: [] as Array<{ name: string; line: string; distance: number; accessibility: string }>,
      commercial: [] as Array<{ name: string; type: string; distance: number }>,
      recreation: [] as Array<{ name: string; type: string; distance: number }>
    };
    
    // ÊïôËÇ≤ÊñΩË®≠
    if (data?.education) {
      const edu = data.education;
      [...edu.elementary, ...edu.juniorHigh, ...edu.highSchool, ...edu.university, ...edu.kindergarten]
        .forEach(school => {
          facilities.education.push({
            name: school.name || 'Â≠¶Ê†°',
            type: school.type || 'ÊïôËÇ≤ÊñΩË®≠',
            distance: school.distance || 500,
            rating: school.rating || undefined
          });
        });
    }
    
    // ÂåªÁôÇÊñΩË®≠
    if (data?.medical) {
      const med = data.medical;
      [...med.hospitals, ...med.clinics, ...med.pharmacies, ...med.dental]
        .forEach(medical => {
          facilities.medical.push({
            name: medical.name || 'ÂåªÁôÇÊ©üÈñ¢',
            type: medical.type || 'ÂåªÁôÇÊñΩË®≠',
            distance: medical.distance || 600,
            specialties: medical.departments || undefined
          });
        });
    }
    
    // ‰∫§ÈÄöÊ©üÈñ¢
    if (data?.transport) {
      data.transport.forEach(station => {
        facilities.transport.push({
          name: station.name || 'ÈßÖ',
          line: station.line || 'Ë∑ØÁ∑ö',
          distance: station.distance || 400,
          accessibility: 'good'
        });
      });
    }
    
    // ÂïÜÊ•≠ÊñΩË®≠
    if (data?.commercial) {
      data.commercial.forEach(shop => {
        facilities.commercial.push({
          name: shop.name || 'ÂïÜÊ•≠ÊñΩË®≠',
          type: shop.type || '„Ç∑„Éß„ÉÉ„Éî„É≥„Ç∞',
          distance: shop.distance || 300
        });
      });
    }
    
    // „É¨„ÇØ„É™„Ç®„Éº„Ç∑„Éß„É≥ÊñΩË®≠
    if (data?.recreation) {
      data.recreation.forEach(rec => {
        facilities.recreation.push({
          name: rec.name || 'ÂÖ¨Âúí',
          type: rec.type || '„É¨„ÇØ„É™„Ç®„Éº„Ç∑„Éß„É≥',
          distance: rec.distance || 800
        });
      });
    }
    
    return facilities;
  };

  const getScoreColor = (score: number): string => {
    if (score >= 90) return '#28a745';
    if (score >= 80) return '#6f42c1';
    if (score >= 70) return '#007bff';
    if (score >= 60) return '#fd7e14';
    return '#dc3545';
  };

  const getScoreGrade = (score: number): string => {
    if (score >= 90) return 'S';
    if (score >= 80) return 'A';
    if (score >= 70) return 'B';
    if (score >= 60) return 'C';
    return 'D';
  };

  // getRiskLevel Èñ¢Êï∞„ÅØÁèæÂú®‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà
  // const getRiskLevel = (risk: number) => {
  //   if (risk >= 80) return { level: 'ÈùûÂ∏∏„Å´ÂÆâÂÖ®', color: '#28a745', icon: '‚úÖ' };
  //   if (risk >= 60) return { level: 'ÂÆâÂÖ®', color: '#6f42c1', icon: 'üõ°Ô∏è' };
  //   if (risk >= 40) return { level: 'Ê≥®ÊÑè', color: '#ffc107', icon: '‚ö†Ô∏è' };
  //   if (risk >= 20) return { level: 'Ë¶ÅË≠¶Êàí', color: '#fd7e14', icon: '‚ö†Ô∏è' };
  //   return { level: 'Âç±Èô∫', color: '#dc3545', icon: '‚ùå' };
  // };

  // Loading state
  if (loading) {
    return (
      <div style={{
        width: '100%',
        height: '500px',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        backgroundColor: '#f8f9fa',
        borderRadius: '15px'
      }}>
        <div style={{ textAlign: 'center' }}>
          <div style={{
            width: '50px',
            height: '50px',
            border: '5px solid #f3f3f3',
            borderTop: '5px solid #007bff',
            borderRadius: '50%',
            animation: 'spin 1s linear infinite',
            margin: '0 auto 20px'
          }}></div>
          <h3 style={{ color: '#007bff', margin: '0 0 10px 0' }}>
            üåç Áµ±ÂêàAPIÂàÜÊûê‰∏≠...
          </h3>
          <p style={{ color: '#666', margin: 0 }}>
            Google Maps & ÂõΩÂúü‰∫§ÈÄöÁúÅAPI„Åã„ÇâÂåÖÊã¨ÁöÑ„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„ÅÑ„Åæ„Åô
          </p>
        </div>
      </div>
    );
  }

  // Initial state
  if (!analysisResult) {
    return (
      <div style={{
        maxWidth: '1200px',
        margin: '0 auto',
        padding: '20px',
        fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif'
      }}>
        <div style={{ textAlign: 'center', marginBottom: '30px' }}>
          <h2 style={{ color: '#2c3e50', fontSize: '2.2rem', marginBottom: '10px', fontWeight: 700 }}>
            üåç Áµ±ÂêàAPIÂàÜÊûê
          </h2>
          <p style={{ color: '#666', fontSize: '1.1rem', lineHeight: 1.6 }}>
            Google Maps API + ÂõΩÂúü‰∫§ÈÄöÁúÅAPIÁµ±Âêà„Å´„Çà„ÇãÂåÖÊã¨ÁöÑ„Å™Âú∞ÂüüÂàÜÊûê
          </p>
        </div>
        
        <div style={{
          background: 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)',
          padding: '30px',
          borderRadius: '15px',
          marginBottom: '30px',
          boxShadow: '0 8px 32px rgba(0, 0, 0, 0.1)'
        }}>
          <div style={{
            background: 'rgba(255, 255, 255, 0.15)',
            padding: '20px',
            borderRadius: '10px',
            marginBottom: '20px',
            color: 'white'
          }}>
            <div style={{ fontSize: '1.1rem', fontWeight: 600, marginBottom: '5px' }}>
              üìç ÂàÜÊûêÂØæË±°‰ΩèÊâÄ
            </div>
            <div style={{ fontSize: '1.2rem', fontWeight: 700 }}>
              {currentAddress || '‰ΩèÊâÄ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì'}
            </div>
            {!currentAddress && (
              <div style={{ fontSize: '0.9rem', marginTop: '5px', opacity: 0.8 }}>
                „Äåüîç ÁîüÊ¥ªÂà©‰æøÊÄßÂàÜÊûê„Äç„Åß‰ΩèÊâÄ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
              </div>
            )}
          </div>
          
          <button
            onClick={analyzeArea}
            disabled={!currentAddress || !coordinates}
            style={{
              background: (!currentAddress || !coordinates) 
                ? 'rgba(255, 255, 255, 0.3)' 
                : 'linear-gradient(135deg, #28a745, #20c997)',
              color: 'white',
              border: 'none',
              padding: '15px 30px',
              borderRadius: '25px',
              fontSize: '1.1rem',
              fontWeight: 600,
              cursor: (!currentAddress || !coordinates) ? 'not-allowed' : 'pointer',
              width: '100%',
              opacity: (!currentAddress || !coordinates) ? 0.6 : 1,
              boxShadow: (!currentAddress || !coordinates) ? 'none' : '0 4px 15px rgba(40, 167, 69, 0.3)'
            }}
          >
            {!currentAddress ? 'üìã „Åæ„Åö„ÄåÁîüÊ¥ªÂà©‰æøÊÄßÂàÜÊûê„Äç„Åß‰ΩèÊâÄ„ÇíÂÖ•Âäõ' : 'üîç Áµ±ÂêàAPIÂàÜÊûê„ÇíÂÆüË°å'}
          </button>
        </div>
        
        {!currentAddress && (
          <div style={{
            background: '#e7f3ff',
            border: '1px solid #b3d9ff',
            padding: '20px',
            borderRadius: '10px',
            textAlign: 'center'
          }}>
            <h4 style={{ color: '#0066cc', margin: '0 0 10px 0' }}>
              üìù ‰ΩøÁî®ÊâãÈ†Ü
            </h4>
            <ol style={{ 
              color: '#0066cc', 
              textAlign: 'left', 
              margin: 0,
              paddingLeft: '20px',
              lineHeight: 1.6
            }}>
              <li>„Äåüîç ÁîüÊ¥ªÂà©‰æøÊÄßÂàÜÊûê„Äç„Éö„Éº„Ç∏„Åß‰ΩèÊâÄ„ÇíÂÖ•Âäõ</li>
              <li>ÂàÜÊûê„ÇíÂÆüË°å„Åó„Å¶„Çπ„Ç≥„Ç¢„ÇíÂèñÂæó</li>
              <li>„Åì„ÅÆ„Éö„Éº„Ç∏„ÅßÁµ±ÂêàAPI„Å´„Çà„ÇãË©≥Á¥∞ÂàÜÊûê</li>
              <li>AIÂàÜÊûê„Åß„Åï„Çâ„Å´Ë©≥„Åó„ÅÑÊ¥ûÂØü„ÇíÂèñÂæó</li>
            </ol>
          </div>
        )}
      </div>
    );
  }

  // Main analysis results
  return (
    <div style={{ width: '100%', fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif' }}>
      <style>
        {`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
          .ai-card {
            transition: all 0.3s ease;
            cursor: pointer;
          }
          .ai-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
          }
          .facility-item {
            transition: all 0.2s ease;
          }
          .facility-item:hover {
            background-color: #f8f9fa;
            border-radius: 8px;
          }
        `}
      </style>
      
      {/* Header */}
      <div style={{
        background: 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)',
        color: 'white',
        padding: '25px',
        borderRadius: '15px',
        marginBottom: '30px',
        textAlign: 'center'
      }}>
        <h2 style={{ margin: '0 0 10px 0', fontSize: '1.8rem', fontWeight: 700 }}>
          üåç Áµ±ÂêàAPIÂàÜÊûêÁµêÊûú
        </h2>
        <p style={{ margin: 0, fontSize: '1.1rem', opacity: 0.9 }}>
          {currentAddress} - Google Maps + ÂõΩÂúü‰∫§ÈÄöÁúÅAPIÁµ±ÂêàÂàÜÊûê
        </p>
      </div>

      {/* Tab Navigation */}
      <div style={{
        display: 'flex',
        marginBottom: '30px',
        borderBottom: '2px solid #f0f0f0',
        overflowX: 'auto'
      }}>
        {[
          { key: 'overview', label: 'üìä Á∑èÂêàË©ï‰æ°' },
          { key: 'ai', label: 'ü§ñ AIÂàÜÊûê' },
          { key: 'market', label: 'üíπ Â∏ÇÂ†¥ÂàÜÊûê' },
          { key: 'facilities', label: 'üè¢ ÊñΩË®≠ÊÉÖÂ†±' },
          { key: 'risks', label: '‚ö†Ô∏è „É™„Çπ„ÇØË©ï‰æ°' },
          { key: 'planning', label: 'üèóÔ∏è ÈÉΩÂ∏ÇË®àÁîª' }
        ].map(tab => (
          <button
            key={tab.key}
            onClick={() => setActiveTab(tab.key as any)}
            style={{
              flex: 1,
              minWidth: '150px',
              padding: '15px 20px',
              border: 'none',
              background: activeTab === tab.key ? '#007bff' : 'transparent',
              color: activeTab === tab.key ? 'white' : '#666',
              fontSize: '0.9rem',
              fontWeight: 600,
              cursor: 'pointer',
              borderRadius: '10px 10px 0 0',
              transition: 'all 0.3s ease'
            }}
          >
            {tab.label}
          </button>
        ))}
      </div>

      {/* Tab Content */}
      {activeTab === 'overview' && (
        <div>
          <div style={{
            background: 'white',
            padding: '30px',
            borderRadius: '15px',
            boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
            marginBottom: '30px',
            textAlign: 'center'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#2c3e50', fontSize: '1.4rem' }}>
              üéØ Á∑èÂêàÁîüÊ¥ªÂà©‰æøÊÄß„Çπ„Ç≥„Ç¢
            </h3>
            <div style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              gap: '30px'
            }}>
              <div style={{
                fontSize: '4rem',
                fontWeight: 700,
                color: getScoreColor(analysisResult.basicScores.total)
              }}>
                {analysisResult.basicScores.total.toFixed(1)}
              </div>
              <div style={{
                fontSize: '3rem',
                fontWeight: 700,
                color: getScoreColor(analysisResult.basicScores.total),
                background: getScoreColor(analysisResult.basicScores.total) + '20',
                padding: '10px 20px',
                borderRadius: '15px'
              }}>
                {getScoreGrade(analysisResult.basicScores.total)}
              </div>
            </div>
            
            {/* „Ç≥„É°„É≥„ÉàÂÖ•Âäõ„Ç®„É™„Ç¢ */}
            <div style={{
              marginTop: '30px',
              padding: '20px',
              background: '#f8f9fa',
              borderRadius: '10px',
              border: '1px solid #dee2e6'
            }}>
              <h4 style={{ 
                margin: '0 0 15px 0', 
                color: '#495057',
                fontSize: '1.1rem',
                textAlign: 'left'
              }}>
                üí¨ „Ç≥„É°„É≥„Éà„Éª„É°„É¢
              </h4>
              <textarea
                placeholder="„Åì„ÅÆÂú∞Âüü„Å´„Å§„ÅÑ„Å¶ÊÄù„Å£„Åü„Åì„Å®„ÄÅÊ∞ó„Å•„ÅÑ„Åü„Åì„Å®„Çí„É°„É¢„Åß„Åç„Åæ„Åô..."
                style={{
                  width: '100%',
                  minHeight: '100px',
                  padding: '15px',
                  border: '1px solid #ced4da',
                  borderRadius: '8px',
                  fontSize: '1rem',
                  fontFamily: 'inherit',
                  resize: 'vertical',
                  outline: 'none',
                  transition: 'border-color 0.3s ease'
                }}
                onFocus={(e) => {
                  (e.target as HTMLTextAreaElement).style.borderColor = '#007bff';
                  (e.target as HTMLTextAreaElement).style.boxShadow = '0 0 0 0.2rem rgba(0, 123, 255, 0.25)';
                }}
                onBlur={(e) => {
                  (e.target as HTMLTextAreaElement).style.borderColor = '#ced4da';
                  (e.target as HTMLTextAreaElement).style.boxShadow = 'none';
                }}
              />
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginTop: '10px',
                fontSize: '0.85rem',
                color: '#6c757d'
              }}>
                <span>üí° „Éí„É≥„Éà: Áâ©‰ª∂„ÅÆÁâπÂæ¥„ÄÅÂë®Ëæ∫Áí∞Â¢É„ÅÆÂç∞Ë±°„ÄÅÊ§úË®é„Éù„Ç§„É≥„Éà„Å™„Å©</span>
                <button
                  style={{
                    background: '#007bff',
                    color: 'white',
                    border: 'none',
                    padding: '8px 16px',
                    borderRadius: '5px',
                    fontSize: '0.9rem',
                    cursor: 'pointer',
                    transition: 'background-color 0.3s ease'
                  }}
                  onMouseOver={(e) => (e.target as HTMLButtonElement).style.backgroundColor = '#0056b3'}
                  onMouseOut={(e) => (e.target as HTMLButtonElement).style.backgroundColor = '#007bff'}
                  onClick={() => {
                    const textarea = document.querySelector('textarea') as HTMLTextAreaElement;
                    if (textarea?.value.trim()) {
                      alert('„Ç≥„É°„É≥„Éà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
                      // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Åß„ÅØ„ÄÅ„Åì„Åì„Åß„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÇÑ„Çµ„Éº„Éê„Éº„Å´‰øùÂ≠ò
                      console.log('‰øùÂ≠ò„Åï„Çå„Åü„Ç≥„É°„É≥„Éà:', textarea.value);
                    } else {
                      alert('„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    }
                  }}
                >
                  üíæ ‰øùÂ≠ò
                </button>
              </div>
            </div>
          </div>

          <div style={{
            background: 'white',
            padding: '25px',
            borderRadius: '15px',
            boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
            marginBottom: '30px'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#2c3e50', fontSize: '1.3rem' }}>
              üìä È†ÖÁõÆÂà•Ë©≥Á¥∞„Çπ„Ç≥„Ç¢
            </h3>
            
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={[
                { name: 'ÊïôËÇ≤Áí∞Â¢É', score: analysisResult.basicScores.education, fullMark: 100 },
                { name: 'ÂåªÁôÇÊñΩË®≠', score: analysisResult.basicScores.medical, fullMark: 100 },
                { name: '‰∫§ÈÄö', score: analysisResult.basicScores.transport, fullMark: 100 },
                { name: 'ÂÆâÂÖ®ÊÄß', score: analysisResult.basicScores.safety, fullMark: 100 },
                { name: 'Ë≤∑„ÅÑÁâ©', score: analysisResult.basicScores.shopping, fullMark: 100 },
                { name: 'Áí∞Â¢É', score: analysisResult.basicScores.environment, fullMark: 100 }
              ]}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" />
                <YAxis domain={[0, 100]} />
                <Tooltip formatter={(value: any) => [`${value}ÁÇπ`, '„Çπ„Ç≥„Ç¢']} />
                <Bar dataKey="score" fill="#007bff" radius={[4, 4, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>
      )}

      {/* AIÂàÜÊûê„Çø„Éñ */}
      {activeTab === 'ai' && (
        <div>
          <div style={{
            background: 'linear-gradient(135deg, #9F7AEA 0%, #667eea 100%)',
            color: 'white',
            padding: '25px',
            borderRadius: '15px',
            marginBottom: '25px',
            textAlign: 'center'
          }}>
            <div style={{ fontSize: '2.5rem', marginBottom: '10px' }}>ü§ñ</div>
            <h3 style={{ margin: '0 0 10px 0', fontSize: '1.6rem', fontWeight: 700 }}>
              AIÂàÜÊûê„É¨„Éù„Éº„Éà
            </h3>
            <p style={{ margin: 0, fontSize: '1.1rem', opacity: 0.9 }}>
              Ê©üÊ¢∞Â≠¶Áøí„Å´„Çà„ÇãÈ´òÂ∫¶„Å™‰ΩèÁí∞Â¢ÉÂàÜÊûê
            </p>
          </div>

          {analysisResult.aiAnalysis ? (
            <div>
              {/* AIÂàÜÊûêÁµêÊûúË°®Á§∫ */}
              <div style={{
                background: 'white',
                padding: '25px',
                borderRadius: '15px',
                boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
                marginBottom: '25px'
              }}>
                <h4 style={{ 
                  color: '#2c3e50', 
                  marginBottom: '20px',
                  fontSize: '1.3rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '10px'
                }}>
                  üéØ AIÁ∑èÂêàË©ï‰æ°
                </h4>
                <div style={{
                  background: '#f8f9fa',
                  padding: '20px',
                  borderRadius: '10px',
                  marginBottom: '20px'
                }}>
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    marginBottom: '10px'
                  }}>
                    <span style={{ fontWeight: 600 }}>ÁîüÊ¥ªÂìÅË≥™„Çπ„Ç≥„Ç¢:</span>
                    <span style={{ 
                      fontSize: '1.2rem', 
                      fontWeight: 700, 
                      color: '#28a745' 
                    }}>
                      {analysisResult.aiAnalysis.livingQualityScore}ÁÇπ
                    </span>
                  </div>
                  <div style={{
                    borderTop: '1px solid #dee2e6',
                    paddingTop: '15px'
                  }}>
                    <h5 style={{ marginBottom: '10px', color: '#495057' }}>Á∑èÂêàË©ï‰æ°:</h5>
                    <p style={{ 
                      margin: 0, 
                      lineHeight: 1.6,
                      color: '#6c757d'
                    }}>
                      {analysisResult.aiAnalysis.overallEvaluation}
                    </p>
                  </div>
                </div>
              </div>
              
              {/* AIÂàÜÊûêÁî®„Ç≥„É°„É≥„Éà„Ç®„É™„Ç¢ */}
              <div style={{
                background: 'white',
                padding: '25px',
                borderRadius: '15px',
                boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)'
              }}>
                <h4 style={{ 
                  margin: '0 0 15px 0', 
                  color: '#495057',
                  fontSize: '1.2rem',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}>
                  ü§ñ AIÂàÜÊûê„Å´ÂØæ„Åô„Çã„Ç≥„É°„É≥„Éà„Éª„É°„É¢
                </h4>
                <textarea
                  id="ai-comment-textarea"
                  placeholder="AIÂàÜÊûêÁµêÊûú„Å´„Å§„ÅÑ„Å¶„ÄÅÊ∞ó„Å•„ÅÑ„Åü„Éù„Ç§„É≥„Éà„ÇÑÁñëÂïèÁÇπ„Çí„É°„É¢„Åß„Åç„Åæ„Åô...\n\n‰æã:\n‚Ä¢ „Åì„ÅÆÂàÜÊûêÁµêÊûú„ÅßÁ¥çÂæó„Åß„Åç„ÇãÁÇπ\n‚Ä¢ ËøΩÂä†„ÅßÁ¢∫Ë™ç„Åó„Åü„ÅÑÊÉÖÂ†±\n‚Ä¢ ÂÆüÈöõ„Å´Ë¶ãÂ≠¶„ÅßÁ¢∫Ë™ç„Åó„Åü„ÅÑÈ†ÖÁõÆ"
                  style={{
                    width: '100%',
                    minHeight: '120px',
                    padding: '15px',
                    border: '1px solid #ced4da',
                    borderRadius: '8px',
                    fontSize: '1rem',
                    fontFamily: 'inherit',
                    resize: 'vertical',
                    outline: 'none',
                    transition: 'border-color 0.3s ease'
                  }}
                  onFocus={(e) => {
                    (e.target as HTMLTextAreaElement).style.borderColor = '#9F7AEA';
                    (e.target as HTMLTextAreaElement).style.boxShadow = '0 0 0 0.2rem rgba(159, 122, 234, 0.25)';
                  }}
                  onBlur={(e) => {
                    (e.target as HTMLTextAreaElement).style.borderColor = '#ced4da';
                    (e.target as HTMLTextAreaElement).style.boxShadow = 'none';
                  }}
                />
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginTop: '15px',
                  fontSize: '0.85rem',
                  color: '#6c757d'
                }}>
                  <span>üí° AIÂàÜÊûê„ÇíÂèÇËÄÉ„Å´„ÄÅÂÆüÈöõ„ÅÆË¶ãÂ≠¶„ÇÑË™øÊüª„ÅßÁ¢∫Ë™ç„Åó„Åü„ÅÑ„Éù„Ç§„É≥„Éà„Çí„É°„É¢„Åó„Åæ„Åó„Çá„ÅÜ</span>
                  <button
                    style={{
                      background: 'linear-gradient(135deg, #9F7AEA, #667eea)',
                      color: 'white',
                      border: 'none',
                      padding: '10px 20px',
                      borderRadius: '6px',
                      fontSize: '0.9rem',
                      cursor: 'pointer',
                      transition: 'transform 0.2s ease, box-shadow 0.2s ease'
                    }}
                    onMouseOver={(e) => {
                      (e.target as HTMLButtonElement).style.transform = 'translateY(-1px)';
                      (e.target as HTMLButtonElement).style.boxShadow = '0 4px 12px rgba(159, 122, 234, 0.3)';
                    }}
                    onMouseOut={(e) => {
                      (e.target as HTMLButtonElement).style.transform = 'translateY(0)';
                      (e.target as HTMLButtonElement).style.boxShadow = 'none';
                    }}
                    onClick={() => {
                      const textarea = document.getElementById('ai-comment-textarea') as HTMLTextAreaElement;
                      if (textarea?.value.trim()) {
                        alert('AIÂàÜÊûê„Ç≥„É°„É≥„Éà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ\n\nÂÆüÈöõ„ÅÆË¶ãÂ≠¶ÊôÇ„Å´ÂèÇËÄÉ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        console.log('AIÂàÜÊûê„Ç≥„É°„É≥„Éà‰øùÂ≠ò:', textarea.value);
                      } else {
                        alert('„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                      }
                    }}
                  >
                    ü§ñ AIÂàÜÊûê„Ç≥„É°„É≥„Éà‰øùÂ≠ò
                  </button>
                </div>
              </div>
            </div>
          ) : (
            <div style={{
              background: 'white',
              padding: '40px',
              borderRadius: '15px',
              boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
              textAlign: 'center'
            }}>
              <div style={{ fontSize: '3rem', marginBottom: '20px' }}>üîÑ</div>
              <h3 style={{ color: '#2c3e50', marginBottom: '15px' }}>
                AIÂàÜÊûêÊ∫ñÂÇô‰∏≠
              </h3>
              <p style={{ color: '#666', fontSize: '1.1rem', marginBottom: '20px' }}>
                Áµ±ÂêàÂàÜÊûê„ÇíÂÆüË°å„Åô„Çã„Å®„ÄÅAI „Å´„Çà„ÇãË©≥Á¥∞ÂàÜÊûê„ÅåÂà©Áî®ÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åô„ÄÇ
              </p>
              <div style={{
                background: '#f8f9fa',
                padding: '20px',
                borderRadius: '10px',
                border: '1px solid #dee2e6',
                fontSize: '0.9rem',
                color: '#6c757d'
              }}>
                üí° AIÂàÜÊûêÊ©üËÉΩ„ÅØÁèæÂú®Â§ßÂπÖÊîπËâØ‰∏≠„Åß„Åô„ÄÇ„Çà„ÇäÁ≤æÂ∫¶„ÅÆÈ´ò„ÅÑÂàÜÊûêÁµêÊûú„ÇíÊèê‰æõ„Åô„Çã„Åü„ÇÅ„ÄÅ
                Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´„ÅÆÊîπÂñÑ„ÇíË°å„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
              </div>
            </div>
          )}
        </div>
      )}

      {/* Â∏ÇÂ†¥ÂàÜÊûê„Çø„Éñ */}
      {activeTab === 'market' && (
        <div>
          <div style={{
            background: 'linear-gradient(135deg, #28a745 0%, #20c997 100%)',
            color: 'white',
            padding: '25px',
            borderRadius: '15px',
            marginBottom: '25px',
            textAlign: 'center'
          }}>
            <div style={{ fontSize: '2.5rem', marginBottom: '10px' }}>üíπ</div>
            <h3 style={{ margin: '0 0 10px 0', fontSize: '1.6rem', fontWeight: 700 }}>
              Â∏ÇÂ†¥ÂàÜÊûê„É¨„Éù„Éº„Éà
            </h3>
            <div style={{
              display: 'flex',
              justifyContent: 'center',
              alignItems: 'center',
              gap: '20px',
              marginTop: '15px',
              flexWrap: 'wrap'
            }}>
              <div style={{
                background: 'rgba(255, 255, 255, 0.2)',
                padding: '10px 20px',
                borderRadius: '20px',
                fontSize: '1.1rem',
                fontWeight: 600
              }}>
                ÊäïË≥áÊ†º‰ªò: {analysisResult.marketAnalysis.investmentRating}
              </div>
              <div style={{
                background: 'rgba(255, 255, 255, 0.2)',
                padding: '10px 20px',
                borderRadius: '20px',
                fontSize: '1.1rem',
                fontWeight: 600
              }}>
                {analysisResult.marketAnalysis.marketTrend === 'rising' ? 'üìà ‰∏äÊòáÂÇæÂêë' :
                 analysisResult.marketAnalysis.marketTrend === 'declining' ? 'üìâ ‰∏ãÈôçÂÇæÂêë' : 'üìä ÂÆâÂÆö'}
              </div>
            </div>
          </div>

          {/* ‰æ°Ê†ºÊÉÖÂ†±„Ç´„Éº„Éâ */}
          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
            gap: '20px',
            marginBottom: '25px'
          }}>
            <div style={{
              background: 'white',
              padding: '25px',
              borderRadius: '15px',
              boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
              textAlign: 'center',
              border: '1px solid #e9ecef'
            }}>
              <div style={{ fontSize: '2rem', marginBottom: '10px' }}>üè†</div>
              <div style={{ color: '#6c757d', fontSize: '0.9rem', marginBottom: '5px' }}>Âπ≥ÂùáÁâ©‰ª∂‰æ°Ê†º</div>
              <div style={{ 
                fontSize: '1.5rem', 
                fontWeight: 700, 
                color: '#28a745',
                marginBottom: '5px'
              }}>
                ¬•{(analysisResult.marketAnalysis.averagePrice / 10000).toFixed(0)}‰∏áÂÜÜ
              </div>
            </div>

            <div style={{
              background: 'white',
              padding: '25px',
              borderRadius: '15px',
              boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
              textAlign: 'center',
              border: '1px solid #e9ecef'
            }}>
              <div style={{ fontSize: '2rem', marginBottom: '10px' }}>üìê</div>
              <div style={{ color: '#6c757d', fontSize: '0.9rem', marginBottom: '5px' }}>Âπ≥Á±≥Âçò‰æ°</div>
              <div style={{ 
                fontSize: '1.5rem', 
                fontWeight: 700, 
                color: '#007bff',
                marginBottom: '5px'
              }}>
                ¬•{(analysisResult.marketAnalysis.pricePerSqm / 10000).toFixed(0)}‰∏áÂÜÜ/„é°
              </div>
            </div>

            <div style={{
              background: 'white',
              padding: '25px',
              borderRadius: '15px',
              boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
              textAlign: 'center',
              border: '1px solid #e9ecef'
            }}>
              <div style={{ fontSize: '2rem', marginBottom: '10px' }}>üìä</div>
              <div style={{ color: '#6c757d', fontSize: '0.9rem', marginBottom: '5px' }}>Âú∞ÂüüÂàÜÊûê„Çπ„Ç≥„Ç¢</div>
              <div style={{ 
                fontSize: '1.5rem', 
                fontWeight: 700, 
                color: '#dc3545',
                marginBottom: '5px'
              }}>
                ÂèÇËÄÉÂÄº
              </div>
              <div style={{ 
                fontSize: '0.8rem', 
                color: '#6c757d',
                marginTop: '8px'
              }}>
                *Á≤æÂ∫¶Âêë‰∏ä‰∏≠
              </div>
            </div>
          </div>

          {/* ‰æ°Ê†ºÊé®Áßª„ÉÅ„É£„Éº„Éà */}
          <div style={{
            background: 'white',
            padding: '25px',
            borderRadius: '15px',
            boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
            marginBottom: '25px'
          }}>
            <h4 style={{
              color: '#2c3e50',
              margin: '0 0 20px 0',
              fontSize: '1.3rem',
              display: 'flex',
              alignItems: 'center',
              gap: '10px'
            }}>
              üìà ‰æ°Ê†ºÊé®ÁßªÔºàÈÅéÂéª5Âπ¥ÈñìÔºâ
            </h4>
            
            <ResponsiveContainer width="100%" height={300}>
              <LineChart data={analysisResult.marketAnalysis.priceHistory}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="year" />
                <YAxis 
                  tickFormatter={(value) => `¬•${(value / 10000).toFixed(0)}‰∏á`}
                />
                <Tooltip 
                  formatter={(value: any) => [`¬•${(value / 10000).toFixed(0)}‰∏áÂÜÜ`, '‰æ°Ê†º']}
                  labelFormatter={(label) => `${label}Âπ¥`}
                />
                <Line 
                  type="monotone" 
                  dataKey="price" 
                  stroke="#28a745" 
                  strokeWidth={3}
                  dot={{ fill: '#28a745', strokeWidth: 2, r: 6 }}
                  activeDot={{ r: 8 }}
                />
              </LineChart>
            </ResponsiveContainer>
          </div>

          {/* Á´∂ÂêàÂàÜÊûê */}
          <div style={{
            background: 'white',
            padding: '25px',
            borderRadius: '15px',
            boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)'
          }}>
            <h4 style={{
              color: '#2c3e50',
              margin: '0 0 15px 0',
              fontSize: '1.3rem',
              display: 'flex',
              alignItems: 'center',
              gap: '10px'
            }}>
              üéØ Âú∞ÂüüÂàÜÊûêÔºàÂèÇËÄÉÊÉÖÂ†±Ôºâ
            </h4>
            <div style={{
              background: '#fff3cd',
              border: '1px solid #ffeaa7',
              padding: '20px',
              borderRadius: '10px',
              marginBottom: '15px'
            }}>
              <div style={{
                display: 'flex',
                alignItems: 'center',
                gap: '10px',
                marginBottom: '10px'
              }}>
                <span style={{ fontSize: '1.2rem' }}>‚ö†Ô∏è</span>
                <strong style={{ color: '#856404' }}>„Éá„Éº„ÇøÂà∂Èôê„Å´„Å§„ÅÑ„Å¶</strong>
              </div>
              <p style={{
                margin: 0,
                fontSize: '0.95rem',
                color: '#856404',
                lineHeight: 1.5
              }}>
                ÁèæÂú®„ÅÆÂàÜÊûê„ÅØÈôêÂÆöÁöÑ„Å™„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇÊ≠£Á¢∫„Å™Á´∂ÂêàÂàÜÊûê„ÇÑÂú∞Âüü„É©„É≥„Ç≠„É≥„Ç∞„Å´„ÅØ„ÄÅ
                „Çà„ÇäÂåÖÊã¨ÁöÑ„Å™‰∏çÂãïÁî£„Éá„Éº„Çø„Éô„Éº„Çπ„Å®„ÅÆÈÄ£Êê∫„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
              </p>
            </div>
            
            <div style={{
              background: '#f8f9fa',
              padding: '20px',
              borderRadius: '10px',
              fontSize: '1.05rem',
              lineHeight: 1.6,
              color: '#495057'
            }}>
              <h5 style={{ 
                color: '#495057', 
                marginBottom: '15px',
                fontSize: '1.1rem'
              }}>üìä ÂàÜÊûê„ÅÆÈôêÁïå„Å®ÊîπÂñÑ‰∫àÂÆö</h5>
              
              <div style={{ marginBottom: '15px' }}>
                <strong>ÁèæÂú®„ÅÆÁä∂Ê≥ÅÔºö</strong>
                <ul style={{ marginTop: '8px', paddingLeft: '20px' }}>
                  <li>Google Maps API„Åã„Çâ„ÅÆÂü∫Êú¨ÁöÑ„Å™ÊñΩË®≠ÊÉÖÂ†±</li>
                  <li>ÂõΩÂúü‰∫§ÈÄöÁúÅAPI„Åã„Çâ„ÅÆÈôêÂÆöÁöÑ„Å™Âú∞‰æ°„Éá„Éº„Çø</li>
                  <li>Áµ±Ë®àÁöÑÊâãÊ≥ï„Å´„Çà„ÇãÁ∞°Êòì„Çπ„Ç≥„Ç¢ÁÆóÂá∫</li>
                </ul>
              </div>
              
              <div style={{ marginBottom: '15px' }}>
                <strong>‰ªäÂæå„ÅÆÊîπÂñÑ‰∫àÂÆöÔºö</strong>
                <ul style={{ marginTop: '8px', paddingLeft: '20px' }}>
                  <li>‰∏çÂãïÁî£ÊÉÖÂ†±„Çµ„Ç§„Éà„Å®„ÅÆÈÄ£Êê∫</li>
                  <li>ÂÆüÈöõ„ÅÆÂèñÂºï‰æ°Ê†º„Éá„Éº„Çø„ÅÆÁµ±Âêà</li>
                  <li>„Çà„ÇäË©≥Á¥∞„Å™Âú∞ÂüüÁµ±Ë®à„ÅÆÂèñÂæó</li>
                  <li>Ê©üÊ¢∞Â≠¶Áøí„Å´„Çà„ÇãÁ≤æÂ∫¶Âêë‰∏ä</li>
                </ul>
              </div>
              
              <div style={{
                background: '#e3f2fd',
                padding: '15px',
                borderRadius: '8px',
                marginTop: '15px',
                border: '1px solid #bbdefb'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '8px'
                }}>
                  <span>üí°</span>
                  <strong style={{ color: '#1565c0' }}>Êé®Â•®‰∫ãÈ†Ö</strong>
                </div>
                <p style={{ 
                  margin: 0, 
                  color: '#1565c0',
                  fontSize: '0.95rem'
                }}>
                  Êú¨ÂàÜÊûêÁµêÊûú„ÅØÂèÇËÄÉÁ®ãÂ∫¶„Å´„Å®„Å©„ÇÅ„ÄÅÂÆüÈöõ„ÅÆÁâ©‰ª∂ÈÅ∏ÊäûÊôÇ„Å´„ÅØÔºö
                  <br />‚Ä¢ ÁèæÂú∞„Åß„ÅÆÂÆüÂú∞Ë™øÊüª
                  <br />‚Ä¢ Ë§áÊï∞„ÅÆ‰∏çÂãïÁî£‰ºöÁ§æ„Å∏„ÅÆÁõ∏Ë´á
                  <br />‚Ä¢ ÊúÄÊñ∞„ÅÆÂ∏ÇÂ†¥ÂãïÂêë„ÅÆÁ¢∫Ë™ç
                  <br />„Çí‰Ωµ„Åõ„Å¶Ë°å„ÅÜ„Åì„Å®„ÇíÂº∑„ÅèÊé®Â•®„Åó„Åæ„Åô„ÄÇ
                </p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* „Åù„ÅÆ‰ªñ„ÅÆ„Çø„Éñ */}
      {(activeTab === 'facilities' || activeTab === 'risks' || activeTab === 'planning') && (
        <div style={{
          background: 'white',
          padding: '40px',
          borderRadius: '15px',
          boxShadow: '0 4px 15px rgba(0, 0, 0, 0.1)',
          textAlign: 'center'
        }}>
          <h3 style={{ color: '#2c3e50', marginBottom: '20px' }}>
            {activeTab === 'facilities' && 'üè¢ ÊñΩË®≠ÊÉÖÂ†±'}
            {activeTab === 'risks' && '‚ö†Ô∏è „É™„Çπ„ÇØË©ï‰æ°'}
            {activeTab === 'planning' && 'üèóÔ∏è ÈÉΩÂ∏ÇË®àÁîª'}
          </h3>
          <p style={{ color: '#666', fontSize: '1.1rem', marginBottom: '20px' }}>
            „Åì„ÅÆÊ©üËÉΩ„ÅØÁèæÂú®ÈñãÁô∫‰∏≠„Åß„Åô„ÄÇËøëÊó•‰∏≠„Å´„É™„É™„Éº„Çπ‰∫àÂÆö„Åß„Åô„ÄÇ
          </p>
          <div style={{
            background: '#f8f9fa',
            padding: '20px',
            borderRadius: '10px',
            border: '1px solid #dee2e6',
            fontSize: '0.9rem',
            color: '#6c757d'
          }}>
            üí° ‰ªäÂæåËøΩÂä†‰∫àÂÆö„ÅÆÊ©üËÉΩ: Ë©≥Á¥∞„Å™ÊñΩË®≠ÊÉÖÂ†±„ÄÅ„É™„Çπ„ÇØ„Éû„ÉÉ„Éó„ÄÅÈÉΩÂ∏ÇË®àÁîª„Éá„Éº„Çø„Å™„Å©
          </div>
        </div>
      )}
    </div>
  );
};

export default EnhancedLifestyleAnalysis;


